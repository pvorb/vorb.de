image: "alpine:latest"

before_script:
  - "apk update"
  - "apk add openssh rsync"
  - "eval $(ssh-agent -s)"
  - "echo \"$SSH_PRIVATE_KEY\" | ssh-add - > /dev/null"
  - "mkdir -p ~/.ssh"
  - "[[ -f /.dockerenv ]] && echo \"$SSH_SERVER_HOSTKEYS\" > ~/.ssh/known_hosts"

deploy:
  script:
    - "rsync -r --chown www-data:www-data --chmod 755 public/ pvo@vorba.ch:~/vorba.ch/"
  only:
    - "feature/gitlab-ci"
  tags:
    - docker
