/**!
 * (c) 2012 Paul Vorbach.
 *
 * MIT License (http://vorb.de/license/mit.html)
 */(function(){function e(e){var t=(new RegExp(e+"="+"(.+?)(&|$)")).exec(location.search);return t===null?null:t[1]}function t(e,t,n){return new Highcharts.Chart({chart:{renderTo:e,zoomType:"x"},title:{text:t},subtitle:{text:typeof document.ontouchstart=="undefined"?"Click and drag in the plot to zoom in":"Drag your finger over the plot to zoom in"},xAxis:{type:"datetime",maxZoom:12096e5,title:{text:"Date"}},yAxis:{title:{text:"Downloads"},min:.5,startOnTick:!1,showFirstLabel:!1},tooltip:{shared:!0},legend:{enabled:!1},plotOptions:{area:{fillColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,"#800"],[1,"rgba(255, 0, 0, 0)"]]},lineWidth:1,marker:{enabled:!1,states:{hover:{enabled:!0,radius:5}}},shadow:!1,states:{hover:{lineWidth:1}}}},series:[{type:"area",name:"Downloads",data:n}]})}function n(e){var t=[],n=e.rows;for(var r in n)t.push([(new Date(n[r].key[1])).getTime(),n[r].value]);return t}function r(e){var t=new Date(e.getFullYear(),0,1);return Math.ceil(((e-t)/864e5+t.getDay()+1)/7)}function i(e){var t=[],n=r(new Date(e[0][0])),i=0,s,o;for(var u in e)s=e[u],o=new Date(s[0]),n!=r(o)?(t.push([o.getTime(),i]),i=s[1],n=r(o)):i+=s[1];return t}function s(e){var t=[],n=(new Date(e[0][0])).getMonth(),r=0,i,s;for(var o in e)i=e[o],s=new Date(i[0]),n!=s.getMonth()?(t.push({x:(new Date(s.getFullYear(),s.getMonth(),1)).getTime(),y:r}),r=i[1],n=s.getMonth()):r+=i[1];return t}$(document).ready(function(){var r,o,u,a=e("package");console.log(a),a===null&&(a="npm"),$("h2").html('Download statistics for package <input type="text" name="package" value="'+a+'"> <input type="submit" value="Show charts">'),$.ajax({url:'http://isaacs.iriscouch.com/downloads/_design/app/_view/pkg?group_level=3&start_key=["'+a+'"]&end_key=["'+a+"%22,{}]",dataType:"jsonp",success:function(e){var r=n(e);t("days","Downloads per day",r);var o=i(r);t("weeks","Downloads per week",o);var u=s(r);t("months","Downloads per month",u)},error:function(e){alert("Could not receive statistical data.")}})})}).call();